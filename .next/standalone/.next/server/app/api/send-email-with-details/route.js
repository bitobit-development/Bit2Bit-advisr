"use strict";(()=>{var e={};e.id=8165,e.ids=[8165],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},72254:e=>{e.exports=require("node:buffer")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},16305:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>y,staticGenerationAsyncStorage:()=>q});var i={};r.r(i),r.d(i,{POST:()=>m});var o=r(49303),s=r(88716),n=r(60670),a=r(87070),p=r(92048),d=r.n(p),u=r(55315),l=r.n(u),c=r(36392),h=r(94891);async function m(e){try{let{to:t,subject:r,templateData:i,attachmentPath:o}=await e.json(),s=l().resolve("./lib/templates/email-template.html"),n=d().readFileSync(s,"utf-8");i.disclaimer=h.G,Object.entries(i).forEach(([e,t])=>{n=n.replace(RegExp(`{{${e}}}`,"g"),String(t))});let p=await (0,c.b)({to:t,subject:r,html:n,attachmentPath:o});return a.NextResponse.json(p)}catch(e){return console.error("send-email-with-details error:",e),a.NextResponse.json({success:!1,error:e.message},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/send-email-with-details/route",pathname:"/api/send-email-with-details",filename:"route",bundlePath:"app/api/send-email-with-details/route"},resolvedPagePath:"/home/runner/workspace/app/api/send-email-with-details/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:f,staticGenerationAsyncStorage:q,serverHooks:y}=x,b="/api/send-email-with-details/route";function g(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:q})}},94891:(e,t,r)=>{r.d(t,{G:()=>i});let i=`
\xa9 2025 Bitobit Pty Ltd. All rights reserved.

This email is intended exclusively for the designated broker recipient. You are prohibited from sharing, distributing, or copying this email in any form. Bitobit Pty Ltd does not accept responsibility for any misuse or unintended use of the information contained within this email.`},36392:(e,t,r)=>{r.d(t,{b:()=>u});var i=r(34927),o=r(30550),s=r(92048),n=r.n(s),a=r(55315),p=r.n(a);let d=new i.dD({auth:{clientId:process.env.AZURE_CLIENT_ID,clientSecret:process.env.AZURE_CLIENT_SECRET,authority:`https://login.microsoftonline.com/${process.env.AZURE_TENANT_ID}`}});async function u({to:e,subject:t,html:r,text:i,attachmentPath:s}){let a=await d.acquireTokenByClientCredential({scopes:["https://graph.microsoft.com/.default"]});if(!a?.accessToken)throw Error("Could not acquire Graph token");let u={subject:t,body:{contentType:r?"HTML":"Text",content:r||i},toRecipients:[{emailAddress:{address:e}}]};if(s){let e=p().join(process.cwd(),s);if(n().existsSync(e)){let t=n().readFileSync(e).toString("base64");u.attachments=[{"@odata.type":"#microsoft.graph.fileAttachment",name:p().basename(e),contentBytes:t}]}}let l=await (0,o.ZP)("https://graph.microsoft.com/v1.0/users/info@bit2bit.co.za/sendMail",{method:"POST",headers:{Authorization:`Bearer ${a.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({message:u,saveToSentItems:!0})});if(!l.ok){let e=await l.text();throw Error(`Graph sendMail failed: ${e}`)}return{success:!0}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,5972,5584],()=>r(16305));module.exports=i})();