(()=>{var e={};e.id=1634,e.ids=[1634],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},64763:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),n(58054),n(6366),n(11506),n(35866);var a=n(23191),s=n(88716),r=n(37922),i=n.n(r),o=n(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);n.d(t,l);let d=["",{children:["new-vehicle-leads",{children:["verify-otp",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,58054)),"/home/runner/workspace/app/new-vehicle-leads/verify-otp/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(n.bind(n,6366)),"/home/runner/workspace/app/new-vehicle-leads/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(n.bind(n,11506)),"/home/runner/workspace/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/runner/workspace/app/new-vehicle-leads/verify-otp/page.tsx"],u="/new-vehicle-leads/verify-otp/page",m={require:n,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/new-vehicle-leads/verify-otp/page",pathname:"/new-vehicle-leads/verify-otp",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},33207:(e,t,n)=>{Promise.resolve().then(n.bind(n,78247))},44830:()=>{},78247:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var a=n(10326),s=n(17577),r=n(35047),i=n(90772),o=n(10937);function l(){let e=(0,r.useSearchParams)().get("mobile"),[t,n]=(0,s.useState)(""),[l,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(!1),m=(0,r.useRouter)(),p=async()=>{if(e&&!(t.length<6)){u(!0),d(null);try{let n=await fetch("/api/validate_otp_clean",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mobile_number:e,otp:t}),credentials:"include"}),a=await n.json();if(a.success){console.log("✅ OTP verified");let t=JSON.parse(localStorage.getItem("lead_info")||"{}"),n=await fetch("/api/vehicle-quote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,surname:t.surname,email:t.email,mobile:t.mobile,lead_type:"VA - Vehicle Quote",id_number:t.id_number,consent:t.consent,discoveryClient:t.discoveryClient})}),a=await n.json();if(a.success){console.log("✅ Lead inserted into Supabase:",a.data);let n=t.name,s=a.data[0].unique_id,r=`Hi ${n}, we've received your vehicle insurance quote request. Your unique reference number is ${s}. Please keep it safe and mention it to the Vitality team upon arrival. On successful application, you'll stand a chance to win a JBL Go 3 Bluetooth Speaker!
Carla Prinsloo,
Your Financial Advisor.`,i=await fetch("/api/send_sms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:e,messageContent:r})}),o=await i.json();o.success?console.log("✅ SMS sent to client with unique ID"):console.error("❌ Failed to send SMS:",o.message),localStorage.removeItem("lead_info"),m.push("/new-vehicle-leads/thank-you")}else console.error("❌ Failed to insert lead:",a.message),m.push(`/new-vehicle-leads/failed?reason=${encodeURIComponent(a.details||a.message||"Lead submission failed")}`)}else d(a.message||"Invalid OTP. Please try again."),u(!1)}catch(e){console.error("❌ OTP validation error:",e),d("Something went wrong. Please try again."),u(!1)}}};return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-white px-4",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-xl shadow-xl max-w-md w-full",children:[a.jsx("div",{className:"flex justify-between mb-6",children:["Sign Up","Verify OTP","Complete"].map((e,t)=>{let n=1===t;return(0,a.jsxs)("div",{className:"flex-1 text-center",children:[a.jsx("div",{className:`w-8 h-8 mx-auto mb-1 rounded-full flex items-center justify-center text-white text-sm font-bold ${n?"bg-blue-600":"bg-gray-300"}`,children:t+1}),a.jsx("span",{className:`text-sm ${n?"text-pink-600 font-medium":"text-gray-500"}`,children:e})]},e)})}),a.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Verify OTP"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["We’ve sent a one-time PIN to your mobile number:"," ",a.jsx("strong",{children:e})]}),a.jsx("div",{className:"flex justify-center my-4",children:a.jsx(o.Zn,{maxLength:6,value:t,onChange:e=>n(e),children:a.jsx(o.hf,{children:[...Array(6)].map((e,t)=>a.jsx(o.cY,{index:t,className:"w-12 h-12 text-xl"},t))})})}),l&&a.jsx("p",{className:"text-sm text-red-600 mt-2",children:l}),a.jsx(i.z,{className:"mt-4 w-full",onClick:p,disabled:c||t.length<6,children:c?"Verifying...":"Verify"})]})})}function d(){return a.jsx(s.Suspense,{fallback:a.jsx("div",{children:"Loading..."}),children:a.jsx(l,{})})}},6366:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r,metadata:()=>s});var a=n(19510);n(67272);let s={title:"Carla Prinsloo Your Financial Advisor - Sign Up Process",description:"Today marks the beginning of your future journey!"};function r({children:e}){return console.log("✅ Public layout loaded"),a.jsx("div",{className:"min-h-screen bg-gray-100",children:e})}},58054:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});let a=(0,n(68570).createProxy)(String.raw`/home/runner/workspace/app/new-vehicle-leads/verify-otp/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[8948,4851,2325,16],()=>n(64763));module.exports=a})();